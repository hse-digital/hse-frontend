{# Define some defaults #}
{% set showNav = params.showNav if params.showNav else "false" %}
{% set showSearch = params.showSearch if params.showSearch else "false" %}

<header class="nhsuk-header
{%- if params.transactional or params.transactionalService %} nhsuk-header--transactional{% endif %}
{%- if params.organisation and params.organisation.name %} nhsuk-header--organisation{% endif %}
{%- if params.classes %} {{ params.classes }}{% endif %}" role="banner"
{%- for attribute, value in params.attributes %} {{ attribute }}="{{ value }}"{% endfor %}>
  <div class="nhsuk-width-container nhsuk-header__container">
    <div class="nhsuk-header__logo {%- if showNav == "false" and showSearch == "false"%} nhsuk-header__logo--only{%- endif %}">
      {%- if params.organisation %}
      <a class="nhsuk-header__link" href="{% if params.homeHref %}{{ params.homeHref }}{% else %}/{% endif %}" aria-label="{{ params.organisation.name }} {{ params.organisation.split }} {{ params.organisation.descriptor }} homepage">
        {%- if params.organisation.logoURL %}
        <img class="nhsuk-org-logo" src="{{ baseUrl }}{{ params.organisation.logoURL }}" alt=""/>
        {%- else -%}
        <svg class="nhsuk-logo" xmlns="http://www.w3.org/2000/svg" role="presentation" focusable="false" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="80px" height="80.461px" viewBox="0 0 80 80.461" enable-background="new 0 0 80 80.461" xml:space="preserve">
        <g>
          <path fill="#FFFFFF" d="M38.409,13.049V1.752C38.409,0.784,37.625,0,36.703,0l0,0H0.046v1.752h34.121l-6.963,6.963H0.046v1.752   h25.406l-6.963,6.963H0.046v1.752h16.692l-1.383,1.383l0,0l0,0l0,0c-0.323,0.323-0.507,0.784-0.507,1.291   c0,0.184,0.046,0.369,0.092,0.553l0,0l1.291,3.781H0.046v1.752H16.83l2.352,6.963H0.046v1.752h24.392   c0.968,0,1.752,0.784,1.752,1.752v5.21H0.046v1.752h36.611c0.968,0,1.752-0.784,1.752-1.752l0,0V28.772   c0-0.968-0.784-1.752-1.752-1.752l0,0l0,0h-5.256c-0.968,0-1.706-0.784-1.706-1.752c0-0.369,0.138-0.738,0.369-1.061l7.931-10.052   l0,0C38.271,13.833,38.409,13.464,38.409,13.049"/>
          <path fill="#FFFFFF" d="M41.867,27.02c-0.968,0-1.752,0.784-1.752,1.752v14.801c0,0.968,0.738,1.752,1.706,1.752c0,0,0,0,0.046,0   h36.611v-1.752H52.334v-5.21c0-0.968,0.784-1.752,1.752-1.752l0,0h24.392v-1.752H59.389l2.352-6.963h16.784v-1.752H62.34   l1.291-3.781l0,0c0.231-0.599,0.092-1.291-0.369-1.752l0,0l0,0l0,0l-1.383-1.383h16.738v-1.798H60.173l-7.009-6.963h25.406V8.715   H51.412l-7.055-6.963h34.121V0H41.867c-0.968,0-1.752,0.784-1.752,1.752l0,0v11.297c0,0.369,0.138,0.784,0.415,1.061h-0.046   l8.069,10.19c0.184,0.277,0.323,0.599,0.323,0.968c0,0.922-0.738,1.706-1.706,1.752L41.867,27.02z"/>
          <path fill="#FFFFFF" d="M1.983,54.64c0-1.199-0.507-1.752-1.983-1.798v-0.83c1.891,0.138,3.55,0.277,5.118,0.277   s3.274-0.138,5.118-0.277v0.83c-1.476,0.046-1.983,0.599-1.983,1.798v8.484h10.329V54.64c0-1.199-0.507-1.752-1.983-1.798v-0.83   c1.89,0.138,3.55,0.277,5.118,0.277c1.568,0,3.274-0.138,5.118-0.277v0.83c-1.476,0.046-1.983,0.599-1.983,1.798v22.409   c0,1.199,0.507,1.752,1.983,1.798v0.83c-1.89-0.138-3.55-0.277-5.118-0.277s-3.274,0.138-5.118,0.277v-0.83   c1.476-0.046,1.983-0.599,1.983-1.798v-9.867H8.3v9.867c0,1.199,0.507,1.752,1.983,1.798v0.83c-1.89-0.138-3.55-0.277-5.118-0.277   s-3.228,0.138-5.118,0.277v-0.83c1.476-0.046,1.983-0.599,1.983-1.798L1.983,54.64z"/>
          <path fill="#FFFFFF" d="M32,69.994c0.83,4.657,4.15,6.87,8.715,6.87c2.536,0,6.179-0.738,6.179-3.919   c0-2.582-2.674-3.274-4.611-3.873l-3.043-0.876c-4.38-1.291-8.715-3.135-8.715-8.161c0-6.64,6.409-8.669,12.818-8.669   c2.72,0,5.395,0.461,7.977,1.383c0,3.089,0.184,5.671,0.323,7.931h-0.83c-0.876-3.965-4.38-5.764-8.207-5.764   c-2.121,0-5.718,0.692-5.718,3.643c0,2.352,2.075,3.043,3.827,3.55l4.519,1.291c4.334,1.245,8.346,2.813,8.346,8.392   c0,5.671-5.718,8.669-12.68,8.669c-3.182,0-6.317-0.507-9.268-1.568c0-3.366-0.138-6.363-0.323-8.807H32V69.994z"/>
          <path fill="#FFFFFF" d="M59.02,54.916c0-1.199-0.507-1.752-1.983-1.798v-0.83h21.441c0.046,2.352,0.138,4.611,0.369,6.916h-0.83   c-0.415-2.352-1.014-3.182-3.366-3.182h-9.314v7.424h5.856c1.937,0,2.213-0.646,2.49-2.167h0.83   c-0.138,1.061-0.231,2.905-0.231,4.058c0,1.153,0.138,3.043,0.231,4.058h-0.83c-0.277-1.522-0.553-2.167-2.49-2.167h-5.856v8.392   h9.821c2.305,0,3.043-0.784,3.781-4.38H80c-0.323,2.72-0.461,5.395-0.507,8.115H57.084v-0.83c1.429-0.046,1.983-0.599,1.983-1.798   v-21.81H59.02z"/>
        </g>
        <image xlink:href="" src="https://services.hse.gov.uk/img/hse.svg"></image>
        </svg>
        <span class="nhsuk-organisation-name">{{ params.organisation.name }}{% if params.organisation.split %} <span class="nhsuk-organisation-name-split">{{ params.organisation.split }}</span>{% endif %}</span>
        {% if params.organisation.descriptor %}<span class="nhsuk-organisation-descriptor">{{ params.organisation.descriptor }}</span>{% endif %}
        {%- endif %}
      </a>
      {%- else -%}
      <a class="nhsuk-header__link{% if params.service %} nhsuk-header__link--service {% endif %}" href="{% if params.homeHref %}{{ params.homeHref }}{% else %}/{% endif %}" aria-label="{% if params.ariaLabel %}{{ params.ariaLabel }}{% else %}NHS homepage{% endif %}">
        <svg class="nhsuk-logo" xmlns="http://www.w3.org/2000/svg" role="presentation" focusable="false" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="80px" height="80.461px" viewBox="0 0 80 80.461" enable-background="new 0 0 80 80.461" xml:space="preserve">
        <g>
          <path fill="#FFFFFF" d="M38.409,13.049V1.752C38.409,0.784,37.625,0,36.703,0l0,0H0.046v1.752h34.121l-6.963,6.963H0.046v1.752   h25.406l-6.963,6.963H0.046v1.752h16.692l-1.383,1.383l0,0l0,0l0,0c-0.323,0.323-0.507,0.784-0.507,1.291   c0,0.184,0.046,0.369,0.092,0.553l0,0l1.291,3.781H0.046v1.752H16.83l2.352,6.963H0.046v1.752h24.392   c0.968,0,1.752,0.784,1.752,1.752v5.21H0.046v1.752h36.611c0.968,0,1.752-0.784,1.752-1.752l0,0V28.772   c0-0.968-0.784-1.752-1.752-1.752l0,0l0,0h-5.256c-0.968,0-1.706-0.784-1.706-1.752c0-0.369,0.138-0.738,0.369-1.061l7.931-10.052   l0,0C38.271,13.833,38.409,13.464,38.409,13.049"/>
          <path fill="#FFFFFF" d="M41.867,27.02c-0.968,0-1.752,0.784-1.752,1.752v14.801c0,0.968,0.738,1.752,1.706,1.752c0,0,0,0,0.046,0   h36.611v-1.752H52.334v-5.21c0-0.968,0.784-1.752,1.752-1.752l0,0h24.392v-1.752H59.389l2.352-6.963h16.784v-1.752H62.34   l1.291-3.781l0,0c0.231-0.599,0.092-1.291-0.369-1.752l0,0l0,0l0,0l-1.383-1.383h16.738v-1.798H60.173l-7.009-6.963h25.406V8.715   H51.412l-7.055-6.963h34.121V0H41.867c-0.968,0-1.752,0.784-1.752,1.752l0,0v11.297c0,0.369,0.138,0.784,0.415,1.061h-0.046   l8.069,10.19c0.184,0.277,0.323,0.599,0.323,0.968c0,0.922-0.738,1.706-1.706,1.752L41.867,27.02z"/>
          <path fill="#FFFFFF" d="M1.983,54.64c0-1.199-0.507-1.752-1.983-1.798v-0.83c1.891,0.138,3.55,0.277,5.118,0.277   s3.274-0.138,5.118-0.277v0.83c-1.476,0.046-1.983,0.599-1.983,1.798v8.484h10.329V54.64c0-1.199-0.507-1.752-1.983-1.798v-0.83   c1.89,0.138,3.55,0.277,5.118,0.277c1.568,0,3.274-0.138,5.118-0.277v0.83c-1.476,0.046-1.983,0.599-1.983,1.798v22.409   c0,1.199,0.507,1.752,1.983,1.798v0.83c-1.89-0.138-3.55-0.277-5.118-0.277s-3.274,0.138-5.118,0.277v-0.83   c1.476-0.046,1.983-0.599,1.983-1.798v-9.867H8.3v9.867c0,1.199,0.507,1.752,1.983,1.798v0.83c-1.89-0.138-3.55-0.277-5.118-0.277   s-3.228,0.138-5.118,0.277v-0.83c1.476-0.046,1.983-0.599,1.983-1.798L1.983,54.64z"/>
          <path fill="#FFFFFF" d="M32,69.994c0.83,4.657,4.15,6.87,8.715,6.87c2.536,0,6.179-0.738,6.179-3.919   c0-2.582-2.674-3.274-4.611-3.873l-3.043-0.876c-4.38-1.291-8.715-3.135-8.715-8.161c0-6.64,6.409-8.669,12.818-8.669   c2.72,0,5.395,0.461,7.977,1.383c0,3.089,0.184,5.671,0.323,7.931h-0.83c-0.876-3.965-4.38-5.764-8.207-5.764   c-2.121,0-5.718,0.692-5.718,3.643c0,2.352,2.075,3.043,3.827,3.55l4.519,1.291c4.334,1.245,8.346,2.813,8.346,8.392   c0,5.671-5.718,8.669-12.68,8.669c-3.182,0-6.317-0.507-9.268-1.568c0-3.366-0.138-6.363-0.323-8.807H32V69.994z"/>
          <path fill="#FFFFFF" d="M59.02,54.916c0-1.199-0.507-1.752-1.983-1.798v-0.83h21.441c0.046,2.352,0.138,4.611,0.369,6.916h-0.83   c-0.415-2.352-1.014-3.182-3.366-3.182h-9.314v7.424h5.856c1.937,0,2.213-0.646,2.49-2.167h0.83   c-0.138,1.061-0.231,2.905-0.231,4.058c0,1.153,0.138,3.043,0.231,4.058h-0.83c-0.277-1.522-0.553-2.167-2.49-2.167h-5.856v8.392   h9.821c2.305,0,3.043-0.784,3.781-4.38H80c-0.323,2.72-0.461,5.395-0.507,8.115H57.084v-0.83c1.429-0.046,1.983-0.599,1.983-1.798   v-21.81H59.02z"/>
        </g>
        <image xlink:href="" src="https://services.hse.gov.uk/img/hse.svg"></image>
        </svg>
        {%- if params.service %}
        <span class="nhsuk-header__service-name">
          {{ params.service.name }}
        </span>
        {%- endif %}
      </a>
      {%- endif %}
    </div>

    {%- if showNav == "false" and showSearch == "false"%}

      {%- if params.transactionalService%}
        <div class="nhsuk-header__transactional-service-name{% if params.transactionalService.longName %} nhsuk-header__transactional-service-name--long{% endif %}">
          <a class="nhsuk-header__transactional-service-name--link" href="{% if params.transactionalService.href %}{{ params.transactionalService.href }}{% else %}/{% endif %}">{{ params.transactionalService.name }}</a>
        </div>
      {%- endif %}

    </div>{# close nhsuk-header__container #}

    {% endif -%}

    {% if showNav == "true" and params.primaryLinks and showSearch == "true" %}

      <div class="nhsuk-header__content" id="content-header">

        <div class="nhsuk-header__menu">
          <button class="nhsuk-header__menu-toggle" id="toggle-menu" aria-controls="header-navigation" aria-label="Open menu">Menu</button>
        </div>

        <div class="nhsuk-header__search">
          <button class="nhsuk-header__search-toggle" id="toggle-search" aria-controls="search" aria-label="Open search">
            <svg class="nhsuk-icon nhsuk-icon__search" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
              <path d="M19.71 18.29l-4.11-4.1a7 7 0 1 0-1.41 1.41l4.1 4.11a1 1 0 0 0 1.42 0 1 1 0 0 0 0-1.42zM5 10a5 5 0 1 1 5 5 5 5 0 0 1-5-5z"></path>
            </svg>
            <span class="nhsuk-u-visually-hidden">Search</span>
          </button>
          <div class="nhsuk-header__search-wrap" id="wrap-search">
            <form class="nhsuk-header__search-form" id="search" action="{{ params.searchAction if params.searchAction else 'https://www.nhs.uk/search/' }}" method="get" role="search">
              <label class="nhsuk-u-visually-hidden" for="search-field">Search the NHS website</label>
              <div class="autocomplete-container" id="autocomplete-container"></div>
              <input class="nhsuk-search__input" id="search-field" name="{{ params.searchInputName if params.searchInputName else 'q' }}" type="search" placeholder="Search" autocomplete="off">
              <button class="nhsuk-search__submit" type="submit">
                <svg class="nhsuk-icon nhsuk-icon__search" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                  <path d="M19.71 18.29l-4.11-4.1a7 7 0 1 0-1.41 1.41l4.1 4.11a1 1 0 0 0 1.42 0 1 1 0 0 0 0-1.42zM5 10a5 5 0 1 1 5 5 5 5 0 0 1-5-5z"></path>
                </svg>
                <span class="nhsuk-u-visually-hidden">Search</span>
              </button>
              <button class="nhsuk-search__close" id="close-search">
                <svg class="nhsuk-icon nhsuk-icon__close" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                  <path d="M13.41 12l5.3-5.29a1 1 0 1 0-1.42-1.42L12 10.59l-5.29-5.3a1 1 0 0 0-1.42 1.42l5.3 5.29-5.3 5.29a1 1 0 0 0 0 1.42 1 1 0 0 0 1.42 0l5.29-5.3 5.29 5.3a1 1 0 0 0 1.42 0 1 1 0 0 0 0-1.42z"></path>
                </svg>
                <span class="nhsuk-u-visually-hidden">Close search</span>
              </button>
            </form>
          </div>
        </div>

      </div>

    </div>{# close nhsuk-header__container #}

    <nav class="nhsuk-header__navigation" id="header-navigation" role="navigation" aria-label="Primary navigation" aria-labelledby="label-navigation">
      <div class="nhsuk-width-container">
        <p class="nhsuk-header__navigation-title"><span id="label-navigation">Menu</span>
          <button class="nhsuk-header__navigation-close" id="close-menu">
            <svg class="nhsuk-icon nhsuk-icon__close" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
              <path d="M13.41 12l5.3-5.29a1 1 0 1 0-1.42-1.42L12 10.59l-5.29-5.3a1 1 0 0 0-1.42 1.42l5.3 5.29-5.3 5.29a1 1 0 0 0 0 1.42 1 1 0 0 0 1.42 0l5.29-5.3 5.29 5.3a1 1 0 0 0 1.42 0 1 1 0 0 0 0-1.42z"></path>
            </svg>
            <span class="nhsuk-u-visually-hidden">Close menu</span>
          </button>
        </p>
        <ul class="nhsuk-header__navigation-list">
          <li class="nhsuk-header__navigation-item nhsuk-header__navigation-item--for-mobile">
            <a class="nhsuk-header__navigation-link" href="{% if params.homeHref %}{{ params.homeHref }}{% else %}/{% endif %}">
              {% if params.homeText %}{{ params.homeText }}{% else %}Home{% endif %}
              <svg class="nhsuk-icon nhsuk-icon__chevron-right" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true">
                <path d="M15.5 12a1 1 0 0 1-.29.71l-5 5a1 1 0 0 1-1.42-1.42l4.3-4.29-4.3-4.29a1 1 0 0 1 1.42-1.42l5 5a1 1 0 0 1 .29.71z"></path>
              </svg>
            </a>
          </li>
          {%- for item in params.primaryLinks %}
          <li class="nhsuk-header__navigation-item">
            <a class="nhsuk-header__navigation-link" href="{{item.url}}">
              {{item.label}}
              <svg class="nhsuk-icon nhsuk-icon__chevron-right" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true">
                <path d="M15.5 12a1 1 0 0 1-.29.71l-5 5a1 1 0 0 1-1.42-1.42l4.3-4.29-4.3-4.29a1 1 0 0 1 1.42-1.42l5 5a1 1 0 0 1 .29.71z"></path>
              </svg>
            </a>
          </li>
          {%- endfor %}
        </ul>
      </div>
    </nav>

    {% endif -%}

    {% if showSearch == "true" and showNav == "false" %}

      <div class="nhsuk-header__content" id="content-header">

        <div class="nhsuk-header__search">
          <button class="nhsuk-header__search-toggle" id="toggle-search" aria-controls="search" aria-label="Open search">
            <svg class="nhsuk-icon nhsuk-icon__search" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
              <path d="M19.71 18.29l-4.11-4.1a7 7 0 1 0-1.41 1.41l4.1 4.11a1 1 0 0 0 1.42 0 1 1 0 0 0 0-1.42zM5 10a5 5 0 1 1 5 5 5 5 0 0 1-5-5z"></path>
            </svg>
            <span class="nhsuk-u-visually-hidden">Search</span>
          </button>
          <div class="nhsuk-header__search-wrap" id="wrap-search">
            <form class="nhsuk-header__search-form" id="search" action="{{ params.searchAction if params.searchAction else 'https://www.nhs.uk/search/' }}" method="get" role="search">
              <label class="nhsuk-u-visually-hidden" for="search-field">Search the NHS website</label>
              <div class="autocomplete-container" id="autocomplete-container"></div>
              <input class="nhsuk-search__input" id="search-field" name="{{ params.searchInputName if params.searchInputName else 'q' }}" type="search" placeholder="Search" autocomplete="off">
              <button class="nhsuk-search__submit" type="submit">
                <svg class="nhsuk-icon nhsuk-icon__search" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                  <path d="M19.71 18.29l-4.11-4.1a7 7 0 1 0-1.41 1.41l4.1 4.11a1 1 0 0 0 1.42 0 1 1 0 0 0 0-1.42zM5 10a5 5 0 1 1 5 5 5 5 0 0 1-5-5z"></path>
                </svg>
                <span class="nhsuk-u-visually-hidden">Search</span>
              </button>
              <button class="nhsuk-search__close" id="close-search">
                <svg class="nhsuk-icon nhsuk-icon__close" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                  <path d="M13.41 12l5.3-5.29a1 1 0 1 0-1.42-1.42L12 10.59l-5.29-5.3a1 1 0 0 0-1.42 1.42l5.3 5.29-5.3 5.29a1 1 0 0 0 0 1.42 1 1 0 0 0 1.42 0l5.29-5.3 5.29 5.3a1 1 0 0 0 1.42 0 1 1 0 0 0 0-1.42z"></path>
                </svg>
                <span class="nhsuk-u-visually-hidden">Close search</span>
              </button>
            </form>
          </div>
        </div>

      </div>

    </div>{# close nhsuk-header__container #}

    {% endif -%}

    {% if showNav == "true" and params.primaryLinks and showSearch == "false" %}

      <div class="nhsuk-header__content" id="content-header">
        <div class="nhsuk-header__menu nhsuk-header__menu--only">
          <button class="nhsuk-header__menu-toggle" id="toggle-menu" aria-controls="header-navigation" aria-label="Open menu">Menu</button>
        </div>
      </div>
    </div>{# close nhsuk-header__container #}

    <nav class="nhsuk-header__navigation" id="header-navigation" role="navigation" aria-label="Primary navigation" aria-labelledby="label-navigation">
      <div class="nhsuk-width-container">
        <p class="nhsuk-header__navigation-title"><span id="label-navigation">Menu</span>
          <button class="nhsuk-header__navigation-close" id="close-menu">
            <svg class="nhsuk-icon nhsuk-icon__close" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
              <path d="M13.41 12l5.3-5.29a1 1 0 1 0-1.42-1.42L12 10.59l-5.29-5.3a1 1 0 0 0-1.42 1.42l5.3 5.29-5.3 5.29a1 1 0 0 0 0 1.42 1 1 0 0 0 1.42 0l5.29-5.3 5.29 5.3a1 1 0 0 0 1.42 0 1 1 0 0 0 0-1.42z"></path>
            </svg>
            <span class="nhsuk-u-visually-hidden">Close menu</span>
          </button>
        </p>
        <ul class="nhsuk-header__navigation-list">
          <li class="nhsuk-header__navigation-item nhsuk-header__navigation-item--for-mobile">
            <a class="nhsuk-header__navigation-link" href="{% if params.homeHref %}{{ params.homeHref }}{% else %}/{% endif %}">
              Home
              <svg class="nhsuk-icon nhsuk-icon__chevron-right" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true">
                <path d="M15.5 12a1 1 0 0 1-.29.71l-5 5a1 1 0 0 1-1.42-1.42l4.3-4.29-4.3-4.29a1 1 0 0 1 1.42-1.42l5 5a1 1 0 0 1 .29.71z"></path>
              </svg>
            </a>
          </li>
          {%- for item in params.primaryLinks %}
          <li class="nhsuk-header__navigation-item">
            <a class="nhsuk-header__navigation-link" href="{{item.url}}">
              {{item.label}}
              <svg class="nhsuk-icon nhsuk-icon__chevron-right" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true">
                <path d="M15.5 12a1 1 0 0 1-.29.71l-5 5a1 1 0 0 1-1.42-1.42l4.3-4.29-4.3-4.29a1 1 0 0 1 1.42-1.42l5 5a1 1 0 0 1 .29.71z"></path>
              </svg>
            </a>
          </li>
          {%- endfor %}
        </ul>
      </div>
    </nav>

    {% endif -%}

</header>
